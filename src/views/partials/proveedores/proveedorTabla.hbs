<style>
    :root {
        /* Variables del Diseño */
        --color-primary: #c62828;
        --color-primary-dark: #8e0000;
        --color-primary-light: #ffebee;
        --color-text: #333;
        --color-border: #ddd;
        --color-white: #ffffff;
        --color-bg: #f5f5f5;
        --font-family-primary: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        
        /* Variables extra para el Modal */
        --color-secondary: #ef4444; 
    }

    body {
        font-family: var(--font-family-primary);
        background-color: var(--color-bg);
        margin: 0;
        padding: 20px;
        overflow-x: hidden; /* Importante para evitar scroll horizontal innecesario */
    }

    /* --- CAMBIOS CLAVE AQUÍ (Breakout Layout) --- */
    .table-container {
        /* 1. Forzar ancho al 95% de la ventana */
        width: 95vw;
        max-width: none; /* Quitamos el límite de 1800px */
        
        /* 2. Centrado absoluto ignorando al padre */
        position: relative;
        left: 50%;
        transform: translateX(-50%);

        /* Estilos visuales */
        background: var(--color-white);
        border-radius: 8px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        padding: 20px;
        margin-top: 20px;
        margin-bottom: 40px;
        overflow: hidden;
    }

    .table-wrapper {
        overflow-x: auto;
        width: 100%;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        min-width: 1000px; /* Asegura que no se aplasten las columnas */
    }

    /* Encabezado */
    thead {
        background-color: var(--color-primary);
        color: var(--color-white);
    }

    thead th {
        padding: 15px;
        text-align: left;
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.9rem;
        white-space: nowrap;
    }

    thead th.text-center { text-align: center; }

    /* Cuerpo */
    tbody tr {
        border-bottom: 1px solid var(--color-border);
        background-color: white;
        transition: background-color 0.2s ease;
    }

    tbody tr:hover {
        background-color: var(--color-primary-light);
    }

    tbody td {
        padding: 15px;
        vertical-align: middle; 
        color: var(--color-text);
        font-size: 1rem;
    }

    tbody td.text-center { text-align: center; }

    .fw-bold { font-weight: 700; }

    /* Badges de estado */
    .status-badge {
        padding: 6px 14px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
        display: inline-block;
    }
    .status-active { background-color: #d1fae5; color: #065f46; }
    .status-inactive { background-color: #fee2e2; color: #991b1b; }

    /* Columna de Acciones */
    .action-column {
        display: flex;
        flex-direction: column;
        gap: 8px;
        align-items: center;
        justify-content: center;
    }

    .btn-ver {
        background-color: var(--color-primary);
        color: white;
        border: none;
        padding: 8px 20px;
        border-radius: 4px;
        cursor: pointer;
        font-weight: 600;
        font-size: 0.9rem;
        transition: background 0.3s;
    }
    .btn-ver:hover { background-color: var(--color-primary-dark); }

    .link-action {
        font-size: 0.85rem;
        color: #666;
        text-decoration: none;
        margin: 0 5px;
    }
    .link-action:hover { color: var(--color-primary); text-decoration: underline; }


    /* --- ESTILOS DEL MODAL --- */
    .modal-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background-color: rgba(0, 0, 0, 0.6); backdrop-filter: blur(2px);
        z-index: 9999;
        display: flex; align-items: center; justify-content: center;
        opacity: 0; visibility: hidden; transition: all 0.3s ease;
    }
    .modal-overlay.active { opacity: 1; visibility: visible; }

    .modal-ficha {
        background: #ffffff; width: 90%; max-width: 500px;
        border-radius: 12px; box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
        transform: scale(0.95) translateY(20px);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        overflow: hidden; position: relative;
    }
    .modal-overlay.active .modal-ficha { transform: scale(1) translateY(0); }

    /* Decoración superior modal */
    .modal-ficha::before {
        content: ''; position: absolute; top: 0; left: 0; right: 0; height: 6px;
        background: var(--color-primary);
    }

    .modal-close {
        position: absolute; top: 1rem; right: 1rem;
        background: transparent; border: none; color: #999;
        font-size: 1.8rem; cursor: pointer; line-height: 1;
    }
    .modal-close:hover { color: var(--color-primary); }

    .ficha-header { text-align: center; padding: 2rem 2rem 1rem; border-bottom: 1px solid #f0f0f0; }
    .ficha-header h3 { margin: 0; font-size: 1.5rem; color: var(--color-text); font-weight: 700; }

    .ficha-body { padding: 1.5rem 2rem; display: flex; flex-direction: column; gap: 1rem; }
    .ficha-row { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px dashed #eee; padding-bottom: 0.5rem; }
    .ficha-row:last-child { border-bottom: none; }
    
    .ficha-label { font-weight: 600; color: #666; font-size: 0.9rem; text-transform: uppercase; }
    .ficha-value { font-weight: 600; color: var(--color-text); font-size: 1rem; text-align: right; }

    .ficha-actions {
        background-color: #f9fafb; padding: 1.5rem; display: flex;
        justify-content: center; gap: 1rem; border-top: 1px solid #f0f0f0;
    }
    
    /* Botones dentro del modal */
    .btn-modal { padding: 0.6rem 1.2rem; border-radius: 6px; font-weight: 600; text-decoration: none; font-size: 0.9rem; cursor: pointer; border: 1px solid transparent;}
    .btn-modal-primary { background-color: var(--color-primary); color: white; }
    .btn-modal-primary:hover { background-color: var(--color-primary-dark); }
    .btn-modal-danger { color: #c62828; border-color: #c62828; background: transparent; }
    .btn-modal-danger:hover { background: #c62828; color: white; }
    .btn-modal-ghost { color: #666; background: transparent; border: 1px solid #ccc; }
    .btn-modal-ghost:hover { background: #eee; }

    .body-no-scroll { overflow: hidden; }
</style>

<div class="table-container">
    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>Razón Social</th>
                    <th>Contacto</th>
                    <th>Teléfono</th>
                    <th>Email</th>
                    <th>RFC</th>
                    <th>Categoría</th>
                    <th class="text-center">Estado</th>
                    {{#if user.administrador}}
                    <th class="text-center">Acciones</th>
                    {{/if}}
                </tr>
            </thead>
            <tbody>
                {{#each proveedores}}
                <tr>
                    <td class="fw-bold">{{razonSocial}}</td>
                    <td>{{nombreContacto}}</td>
                    <td>{{telefono}}</td>
                    <td>{{email}}</td>
                    <td>{{rfc}}</td>
                    <td>{{categoria}}</td>
                    
                    <td class="text-center">
                        {{#if activo}}
                            <span class="status-badge status-active">Activo</span>
                        {{else}}
                            <span class="status-badge status-inactive">Inactivo</span>
                        {{/if}}
                    </td>

                    {{#if ../user.administrador}}
                    <td class="text-center">
                        <div class="action-column">
                            <button 
                                class="btn-ver status-btn"
                                data-id="{{_id}}"
                                data-razon-social="{{razonSocial}}"
                                data-contacto="{{nombreContacto}}"
                                data-telefono="{{telefono}}"
                                data-email="{{email}}"
                                data-rfc="{{rfc}}"
                                data-categoria="{{categoria}}"
                                data-activo="{{#if activo}}Activo{{else}}Inactivo{{/if}}"
                                data-edit="/editarProveedor/{{_id}}"
                                data-delete="/eliminarProveedor/{{_id}}"
                            >
                                Ver Ficha
                            </button>
                            
                            <div style="margin-top: 5px;">
                                <a href="/editarProveedor/{{_id}}" class="link-action">Editar</a> | 
                                <a href="/eliminarProveedor/{{_id}}" class="link-action" style="color: #c62828;">Eliminar</a>
                            </div>
                        </div>
                    </td>
                    {{/if}}
                </tr>
                {{/each}}
            </tbody>
        </table>
    </div>
</div>

<div id="overlay-modal-ficha" class="modal-overlay" hidden>
    <div id="modal-ficha" class="modal-ficha" role="dialog" aria-modal="true" aria-labelledby="ficha-title" hidden>
        <button class="modal-close" type="button" aria-label="Cerrar">×</button>

        <header class="ficha-header">
            <h3 id="ficha-title">Ficha de Proveedor</h3>
        </header>

        <section class="ficha-body">
            <div class="ficha-row">
                <span class="ficha-label">Razón Social</span>
                <span id="ficha-razon-social" class="ficha-value"></span>
            </div>
            <div class="ficha-row">
                <span class="ficha-label">Contacto</span>
                <span id="ficha-contacto" class="ficha-value"></span>
            </div>
            <div class="ficha-row">
                <span class="ficha-label">Teléfono</span>
                <a id="ficha-telefono" class="ficha-value" href="#"></a>
            </div>
            <div class="ficha-row">
                <span class="ficha-label">Email</span>
                <a id="ficha-email" class="ficha-value" href="#"></a>
            </div>
            <div class="ficha-row">
                <span class="ficha-label">RFC</span>
                <span id="ficha-rfc" class="ficha-value"></span>
            </div>
            <div class="ficha-row">
                <span class="ficha-label">Categoría</span>
                <span id="ficha-categoria" class="ficha-value"></span>
            </div>
            <div class="ficha-row">
                <span class="ficha-label">Estado</span>
                <span id="ficha-activo" class="ficha-value"></span>
            </div>
        </section>

        <footer class="ficha-actions">
            <a id="ficha-btn-editar" class="btn-modal btn-modal-primary" href="#">Editar</a>
            <a id="ficha-btn-eliminar" class="btn-modal btn-modal-danger" href="#">Eliminar</a>
            <button id="ficha-btn-cerrar" class="btn-modal btn-modal-ghost" type="button">Cerrar</button>
        </footer>
    </div>
</div>

<script>
    (function () {
        // 1. Elementos del Modal y Overlay
        const overlay   = document.getElementById('overlay-modal-ficha');
        const modal     = document.getElementById('modal-ficha');
        const closeBtn  = modal.querySelector('.modal-close');
        const cerrarBtn = document.getElementById('ficha-btn-cerrar');

        // 2. Campos dentro de la Ficha (Modal)
        const elRazonSocial = document.getElementById('ficha-razon-social');
        const elContacto    = document.getElementById('ficha-contacto');
        const elTelefono    = document.getElementById('ficha-telefono');
        const elEmail       = document.getElementById('ficha-email');
        const elRfc         = document.getElementById('ficha-rfc');
        const elCategoria   = document.getElementById('ficha-categoria');
        const elActivo      = document.getElementById('ficha-activo');
        const btnEdit       = document.getElementById('ficha-btn-editar');
        const btnDel        = document.getElementById('ficha-btn-eliminar');

        // Funciones para abrir y cerrar el modal
        function openModal() {
            overlay.hidden = false;
            modal.hidden = false;
            setTimeout(() => {
                overlay.classList.add('active');
            }, 10); // Pequeño retraso para la animación CSS
            document.body.classList.add('body-no-scroll');
        }

        function closeModal() {
            overlay.classList.remove('active');
            setTimeout(() => {
                overlay.hidden = true;
                modal.hidden = true;
                document.body.classList.remove('body-no-scroll');
            }, 300); // Esperar a la animación
        }

        // Función para llenar la ficha con los datos del botón
        function fillCard({ razonSocial, contacto, telefono, email, rfc, categoria, activo, editUrl, deleteUrl }) {
            elRazonSocial.textContent = razonSocial || '';
            elContacto.textContent    = contacto || '';
            elRfc.textContent         = rfc || '';
            elCategoria.textContent   = categoria || '';

            // Teléfono
            elTelefono.textContent = telefono || '';
            elTelefono.href = telefono ? `tel:${telefono}` : '#';

            // Email
            elEmail.textContent = email || '';
            elEmail.href = email ? `mailto:${email}` : '#';
            
            // Estado Activo
            elActivo.textContent = activo || 'Inactivo';
            // Ajustar color dinámicamente en el modal también
            elActivo.style.color = (activo === 'Activo') ? '#065f46' : '#991b1b'; 

            btnEdit.href = editUrl || '#';
            btnDel.href  = deleteUrl || '#';
        }

        // 3. Delegación de eventos para el botón "Status" (Ver Ficha)
        document.addEventListener('click', function (e) {
            // Buscamos el botón que tenga la clase status-btn
            const btn = e.target.closest('.status-btn');
            if (!btn) return;

            const payload = {
                razonSocial: btn.dataset.razonSocial,
                contacto: btn.dataset.contacto,
                telefono: btn.dataset.telefono,
                email: btn.dataset.email,
                rfc: btn.dataset.rfc,
                categoria: btn.dataset.categoria,
                activo: btn.dataset.activo,
                editUrl: btn.dataset.edit,
                deleteUrl: btn.dataset.delete
            };

            fillCard(payload);
            openModal();
        });

        // 4. Eventos para cerrar el modal
        closeBtn.addEventListener('click', closeModal);
        cerrarBtn.addEventListener('click', closeModal);
        overlay.addEventListener('click', (e) => {
            if(e.target === overlay) closeModal();
        });

        // Cerrar con tecla Escape
        document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape' && !overlay.hidden) closeModal();
        });

        // 5. Confirmación para eliminar desde el modal
        btnDel.addEventListener('click', function (e) {
            const ok = confirm('¿Seguro que deseas eliminar este proveedor?');
            if (!ok) e.preventDefault();
        });
    })();
</script>